# SurfsUp Shop - Render Deployment Guide

## Prerequisites
- GitHub repository with your Sylius code
- Render account (free tier available)

## Deployment Steps

### Method 1: Using render.yaml (Recommended)
1. **Push to GitHub**: Ensure your latest code is pushed to GitHub
2. **Connect to Render**: 
   - Go to [render.com](https://render.com)
   - Click "New +" → "Blueprint"
   - Connect your GitHub repository
   - Select the repository containing your Sylius project
3. **Deploy**: Render will automatically detect the `render.yaml` file and deploy

### Method 2: Manual Configuration
1. **Create Web Service**:
   - Go to [render.com](https://render.com)
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
2. **Configure Service**:
   - **Name**: `surfsup-shop`
   - **Environment**: `Docker`
   - **Dockerfile Path**: `./Dockerfile`
   - **Docker Context**: `.` (root directory)
   - **Plan**: `Starter` (free tier)
   - **Region**: `Oregon` (or closest to your users)

## Environment Variables

The following environment variables are configured in `render.yaml`:

```yaml
APP_ENV: prod
APP_SECRET: [auto-generated by Render]
DATABASE_URL: sqlite:///var/www/html/var/data.db
SYMFONY_ENV: prod
COMPOSER_ALLOW_SUPERUSER: 1
```

### Optional Environment Variables
If you need additional configuration, add these in the Render dashboard:

```bash
# For production database (if not using SQLite)
DATABASE_URL: postgresql://user:password@host:port/database

# For email configuration
MAILER_DSN: smtp://user:password@smtp.example.com:587

# For file storage
SYLIUS_STORAGE_FILESYSTEM_LOCAL_PATH: /var/www/html/public/media
```

## Database Setup

### SQLite (Default)
- Uses SQLite database stored in `/var/www/html/var/data.db`
- No additional setup required
- Good for development and small projects

### PostgreSQL (Recommended for Production)
1. **Create Database**:
   - In Render dashboard, create a new PostgreSQL database
   - Note the connection details
2. **Update Environment Variables**:
   - Set `DATABASE_URL` to your PostgreSQL connection string
   - Format: `postgresql://user:password@host:port/database`

## Post-Deployment Setup

### 1. Database Migration
After deployment, you may need to run database migrations:

```bash
# Access the service shell in Render dashboard
php bin/console doctrine:database:create --if-not-exists
php bin/console doctrine:migrations:migrate --no-interaction
php bin/console sylius:install --no-interaction
```

### 2. Create Admin User
```bash
php bin/console sylius:user:create
```

### 3. Load Sample Data (Optional)
```bash
php bin/console sylius:fixtures:load
```

## Custom Domain (Optional)

1. **Add Custom Domain**:
   - In Render dashboard, go to your service
   - Click "Settings" → "Custom Domains"
   - Add your domain name
2. **Configure DNS**:
   - Point your domain's CNAME record to the Render service URL
   - Or use A record with the provided IP address

## Troubleshooting

### Common Issues

1. **Build Fails**:
   - Check that `composer.json` and `composer.lock` are present
   - Ensure all required PHP extensions are installed in Dockerfile
   - Check build logs for specific error messages

2. **Service Won't Start**:
   - Verify Apache configuration in Dockerfile
   - Check that port 80 is exposed
   - Ensure `.htaccess` file is properly configured

3. **Database Connection Issues**:
   - Verify `DATABASE_URL` environment variable
   - Check database service is running (if using PostgreSQL)
   - Ensure database exists and is accessible

4. **File Permission Issues**:
   - Check that `var/` directory has write permissions
   - Verify file ownership is set to `www-data`

### Logs
- **Build Logs**: Available in Render dashboard during deployment
- **Runtime Logs**: Available in service dashboard under "Logs" tab
- **Application Logs**: Check `/var/www/html/var/log/` directory

## Performance Optimization

### For Production
1. **Enable Caching**:
   - Set up Redis for session and cache storage
   - Configure Symfony cache pools

2. **CDN Setup**:
   - Use Render's CDN or external CDN for static assets
   - Configure proper cache headers

3. **Database Optimization**:
   - Use PostgreSQL instead of SQLite for better performance
   - Configure proper database indexes

## Security Considerations

1. **Environment Variables**:
   - Never commit sensitive data to repository
   - Use Render's environment variable system
   - Rotate `APP_SECRET` regularly

2. **File Permissions**:
   - Ensure proper file permissions are set
   - Don't expose sensitive directories

3. **HTTPS**:
   - Render provides HTTPS by default
   - Ensure all traffic is redirected to HTTPS

## Monitoring

1. **Health Checks**:
   - Service health is monitored at `/` endpoint
   - Configure custom health check if needed

2. **Metrics**:
   - Monitor CPU, memory, and response times
   - Set up alerts for service downtime

## Support

- **Render Documentation**: [render.com/docs](https://render.com/docs)
- **Sylius Documentation**: [docs.sylius.com](https://docs.sylius.com)
- **Community Support**: [Sylius Slack](https://sylius.com/slack)
